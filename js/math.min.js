const ONE_SECOND=1e3,FAR_PLANE=200,NEAR_PLANE=.1,EPSILON=1e-6,PI=Math.PI,PI2=2*PI,DEGREE=PI/180,RADIAN=180/PI,logEvent=t=>{const s=document.getElementById("log_div");s&&(s.innerHTML+=t+"<br><br>")},setValue=(t,s,i)=>(t<s?t=s:t>i&&(t=i),t),wrapPi=t=>(t+=PI,t=Math.floor(1*t/PI2)*PI2,t-=PI);class Camera{constructor(t,s,i=NEAR_PLANE,h=FAR_PLANE){this.fieldOfView=t,this.aspectRatio=s,this.nearPlane=i,this.farPlane=h,this.origin=new Vec3,this.lookAt=new Vec3,this.up=new Vec3(0,1,0),this.proj=new Mat4,this.camera=new Mat4,this.view=new Mat4,this.viewProj=new Mat4,this.world=new Mat4}setup(t,s,i){this.origin.set(t),this.lookAt.set(s),this.up.set(i),this.proj.set(Mat4.perspective(this.fieldOfView,this.aspectRatio,this.nearPlane,this.farPlane)),this.camera.set(Mat4.lookAt(this.origin,this.lookAt,this.up)),this.view.set(Mat4.inverse(this.camera)),this.viewProj.set(Mat4.multiply(this.proj,this.view))}update(t,s){this.world.rotate(t,s)}}function getIcosahedronVerticesIndicesNormals(){var t=1,s=1/((1+Math.sqrt(5))/2),i=0,h=[0,s,-t,-s,t,0,s,t,0,-s,t,0,0,s,t,s,t,0,0,-s,t,0,s,t,-t,0,s,t,0,s,0,s,t,0,-s,t,0,-s,-t,0,s,-t,t,0,-s,-t,0,-s,0,s,-t,0,-s,-t,s,-t,0,0,-s,t,-s,-t,0,-s,-t,0,0,-s,-t,s,-t,0,-t,0,s,-s,t,0,-t,0,-s,-t,0,-s,-s,-t,0,-t,0,s,t,0,-s,s,t,0,t,0,s,t,0,s,s,-t,0,t,0,-s,-t,0,s,0,s,t,-s,t,0,s,t,0,0,s,t,t,0,s,-s,t,0,0,s,-t,-t,0,-s,t,0,-s,0,s,-t,s,t,0,-t,0,-s,0,-s,-t,-s,-t,0,s,-t,0,0,-s,-t,t,0,-s,-s,-t,0,0,-s,t,-t,0,s,t,0,s,0,-s,t,s,-t,0];function e(t,s){return[t[0]-s[0],t[1]-s[1],t[2]-s[2]]}function r(t,s){return[t[1]*s[2]-t[2]*s[1],t[2]*s[0]-t[0]*s[2],t[0]*s[1]-t[1]*s[0]]}function n(t){var s=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(0!=s){var i=1/s;return[t[0]*i,t[1]*i,t[2]*i]}return t}var a=[],u=null,o=h.length,l=new Array(o/3);for(i=0;i<o;i+=9)t=[h[i],h[i+1],h[i+2]],s=[h[i+3],h[i+4],h[i+5]],c=[h[i+6],h[i+7],h[i+8]],u=n(r(e(t,s),e(t,c))),a=a.concat(u,u,u);for(o=l.length,i=0;i<o;++i)l[i]=i;return{positions:h,indices:l,normals:a}}function calcNormals(t){if(Array.isArray(t)&t.length>9){function s(t,s){return[t[0]-s[0],t[1]-s[1],t[2]-s[2]]}function h(t,s){return[t[1]*s[2]-t[2]*s[1],t[2]*s[0]-t[0]*s[2],t[0]*s[1]-t[1]*s[0]]}function e(t){var s=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(0!=s){var i=1/s;return[t[0]*i,t[1]*i,t[2]*i]}return t}var r=[],n=null,u=t.length;new Array(u/3);for(i=0;i<u;i+=9)a=[t[i],t[i+1],t[i+2]],b=[t[i+3],t[i+4],t[i+5]],c=[t[i+6],t[i+7],t[i+8]],n=e(h(s(a,b),s(a,c))),r=r.concat(n,n,n);return r}return null}Object.freeze(Camera);class Vec3 extends Float32Array{constructor(t=0,s=0,i=0){super([t,s,i])}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get roll(){return this[0]}get pitch(){return this[1]}get yaw(){return this[2]}get heading(){return this[0]}get bank(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set roll(t){this[0]=t}set pitch(t){this[1]=t}set yaw(t){this[2]=t}set heading(t){this[0]=t}set bank(t){this[2]=t}toString(){return"("+this[0]+", "+this[1]+", "+this[2]+")"}static addition(t,s){return new Vec3(t[0]+s[0],t[1]+s[1],t[2]+s[2])}static create(){return new Vec3}static crossProduct(t,s){return new Vec3(t[1]*s[2]-t[2]*s[1],t[2]*s[0]-t[0]*s[2],t[0]*s[1]-t[1]*s[0])}static magnitude(t){return Math.hypot(t[0],t[1],t[2])}static divide(t,s){return new Vec3(t[0]/s[0],t[1]/s[1],t[2]/s[2])}static dotProduct(t,s){return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]}static isVec3(t){return Object.getPrototypeOf(t).constructor.name===this.name}static modulus(t,s){return new Vec3(t[0]%s[0],t[1]%s[1],t[2]%s[2])}static multiply(t,s){return new Vec3(t[0]*s[0],t[1]*s[1],t[2]*s[2])}static subtract(t,s){return new Vec3(t[0]-s[0],t[1]-s[1],t[2]-s[2])}static normalize(t){let s=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(0!==s){let i=1/Math.sqrt(s);t[0]*=i,t[1]*=i,t[2]*=i}return t}static toQuat(t){let s=Math.cos,i=Math.sin,h=.5*s(t[0]),e=.5*i(t[0]),r=.5*s(t[1]),n=.5*i(t[1]),a=.5*s(t[2]),u=.5*i(t[2]),c=new Quat;return c.w=a*r*h+u*n*e,c.x=a*r*e-u*n*h,c.y=u*r*e+a*n*h,c.z=u*r*h-a*n*e,c}clone(){return(new Vec3).copy(this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this}magSq(){return this[0]*this[0]+this[1]*this[1]+this[2]*this[2]}mag(){return Math.hypot(this[0],this[1],this[2])}toRandom(t){this[0]=rand(t),this[1]=rand(t),this[2]=rand(t)}toRandomEuler(){this[0]=rand(180),this[1]=rand(180),this[2]=rand(90)}toNegate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this}toNorm(){let t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2];if(0!==t){let s=1/Math.sqrt(t);this[0]*=s,this[1]*=s,this[2]*=s}return this}isEqual(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]}isZero(){return 0===this[0]&&0===this[1]&&0===this[2]}toZero(){this[0]=0,this[1]=0,this[2]=0}add(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this}sub(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}mul(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this}div(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this}mod(t){return this[0]%=t[0],this[1]%=t[1],this[2]%=t[2],this}cross(t){return this[0]=this[1]*t[2]-this[2]*t[1],this[1]=this[2]*t[0]-this[0]*t[2],this[2]=this[0]*t[1]-this[1]*t[0],this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}dist(t){return Math.hypot(this[0]-t[0],this[1]-t[1],this[2]-t[2])}slerp(t,s){return t.sub(this).mul(s).add(this)}addScalar(t){return this[0]+=t,this[1]+=t,this[2]+=t,this}subScalar(t){return this[0]-=t,this[1]-=t,this[2]-=t,this}divScalar(t){return this[0]/=t,this[1]/=t,this[2]/=t,this}mulScalar(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}modScalar(t){return this[0]%=t,this[1]%=t,this[2]%=t,this}mulMat3(t){let s=this[0],i=this[1],h=this[2];return this[0]=t[0]*s+t[3]*i+t[6]*h,this[1]=t[1]*s+t[4]*i+t[7]*h,this[2]=t[2]*s+t[5]*i+t[8]*h,this}mulMat4(t){let s=1/(t[3]*this[0]+t[7]*this[1]+t[11]*this[2]+t[15]);return this[0]=(t[0]*this[0]+t[4]*this[1]+t[8]*this[2]+t[12])*s,this[1]=(t[1]*this[0]+t[5]*this[1]+t[9]*this[2]+t[13])*s,this[2]=(t[2]*this[0]+t[6]*this[1]+t[10]*this[2]+t[14])*s,this}mulQuat(t){let s=this[0],i=this[1],h=this[2],e=t.x,r=t.y,n=t.z,a=t.w,u=a*s+r*h-n*i,c=a*i+n*s-e*h,o=a*h+e*i-r*s,l=-e*s-r*i-n*h;return this[0]=u*a+l*-e+c*-n-o*-r,this[1]=c*a+l*-r+o*-e-u*-n,this[2]=o*a+l*-n+u*-r-c*-e,this}sum(){return this[0]+this[1]+this[2]}canonize(){let t=Math.Pi,s=.5*t;wrapPi(this[1]),this[1]<s?(this[0]+=t,this[1]=-t-this[1],this[2]+=t):this[1]>s&&(this[0]+=t,this[1]=t-this[1],this[2]+=t),Math.abs(this[1])>s-1e-4?(this[0]+=this[2],this[2]=0):wrapPi(this[2]),wrapPi(this[0])}}Object.freeze(Vec3);class Vec4 extends Float32Array{constructor(t=0,s=0,i=0,h=1){super([t,s,i,h])}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}get roll(){return this[0]}get pitch(){return this[1]}get yaw(){return this[2]}get heading(){return this[0]}get bank(){return this[2]}get R(){return this[0]}get G(){return this[1]}get B(){return this[2]}get A(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}set roll(t){this[0]=t}set pitch(t){this[1]=t}set yaw(t){this[2]=t}set heading(t){this[0]=t}set bank(t){this[2]=t}set R(t){this[0]=t}set G(t){this[1]=t}set B(t){this[2]=t}set A(t){this[3]=t}toString(){return"("+this[0]+", "+this[1]+", "+this[2]+", "+this[3]+")"}static isVec4(t){return Object.getPrototypeOf(t).constructor.name===this.name}static addition(t,s){return new Vec4(t[0]+s[0],t[1]+s[1],t[2]+s[2])}static create(){return new Vec4}static crossProduct(t,s){return new Vec4(t[1]*s[2]-t[2]*s[1],t[2]*s[0]-t[0]*s[2],t[0]*s[1]-t[1]*s[0])}static divide(t,s){return new Vec4(t[0]/s[0],t[1]/s[1],t[2]/s[2])}static dotProduct(t,s){return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]}static modulus(t,s){return new Vec4(t[0]%s[0],t[1]%s[1],t[2]%s[2])}static multiply(t,s){return new Vec4(t[0]*s[0],t[1]*s[1],t[2]*s[2])}static magnitude(t){return Math.hypot(t[0],t[1],t[2])}static subtract(t,s){return new Vec4(t[0]-s[0],t[1]-s[1],t[2]-s[2])}static distance(t,s){return Math.hypot(t[0]-s[0],t[1]-s[1],t[2]-s[2])}static normalize(t){let s=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(0!==s){let i=1/Math.sqrt(s);t[0]*=i,t[1]*=i,t[2]*=i}return t}static toQuat(t){let s=Math.cos,i=Math.sin,h=.5*s(t[0]),e=.5*i(t[0]),r=.5*s(t[1]),n=.5*i(t[1]),a=.5*s(t[2]),u=.5*i(t[2]),c=new Quat;return c.w=a*r*h+u*n*e,c.x=a*r*e-u*n*h,c.y=u*r*e+a*n*h,c.z=u*r*h-a*n*e,c}clone(){let t=new Vec4;return t.set(this),t}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this}magSq(){return this[0]*this[0]+this[1]*this[1]+this[2]*this[2]}mag(){return Math.hypot(this[0],this[1],this[2])}toRandom(t){this[0]=rand(t),this[1]=rand(t),this[2]=rand(t)}toRandomEuler(){this[0]=rand(180),this[1]=rand(180),this[2]=rand(90)}toNegate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this}toNorm(){let t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2];if(0!==t){let s=1/Math.sqrt(t);this[0]*=s,this[1]*=s,this[2]*=s}return this}isEqual(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]}isZero(){return 0===this[0]&&0===this[1]&&0===this[2]}toZero(){return this[0]=0,this[1]=0,this[2]=0,this[3]=0,this}add(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this}sub(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}mul(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this}div(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this}mod(t){return this[0]%=t[0],this[1]%=t[1],this[2]%=t[2],this}cross(t){return this[0]=this[1]*t[2]-this[2]*t[1],this[1]=this[2]*t[0]-this[0]*t[2],this[2]=this[0]*t[1]-this[1]*t[0],this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}dist(t){return Math.hypot(this[0]-t[0],this[1]-t[1],this[2]-t[2])}slerp(t,s){return t.sub(this).mul(s).add(this)}addScalar(t){return this[0]+=t,this[1]+=t,this[2]+=t,this}subScalar(t){return this[0]-=t,this[1]-=t,this[2]-=t,this}divScalar(t){return this[0]/=t,this[1]/=t,this[2]/=t,this}mulScalar(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}modScalar(t){return this[0]%=t,this[1]%=t,this[2]%=t,this}mulMat3(t){let s=this[0],i=this[1],h=this[2];return this[0]=t[0]*s+t[3]*i+t[6]*h,this[1]=t[1]*s+t[4]*i+t[7]*h,this[2]=t[2]*s+t[5]*i+t[8]*h,this}mulMat4(t){let s=1/(t[3]*this[0]+t[7]*this[1]+t[11]*this[2]+t[15]);return this[0]=(t[0]*this[0]+t[4]*this[1]+t[8]*this[2]+t[12])*s,this[1]=(t[1]*this[0]+t[5]*this[1]+t[9]*this[2]+t[13])*s,this[2]=(t[2]*this[0]+t[6]*this[1]+t[10]*this[2]+t[14])*s,this}mulQuat(t){let s=this[0],i=this[1],h=this[2],e=t.x,r=t.y,n=t.z,a=t.w,u=a*s+r*h-n*i,c=a*i+n*s-e*h,o=a*h+e*i-r*s,l=-e*s-r*i-n*h;return this[0]=u*a+l*-e+c*-n-o*-r,this[1]=c*a+l*-r+o*-e-u*-n,this[2]=o*a+l*-n+u*-r-c*-e,this}sum(){return this[0]+this[1]+this[2]}canonize(){let t=Math.Pi,s=.5*t;wrapPi(this[1]),this[1]<s?(this[0]+=t,this[1]=-t-this[1],this[2]+=t):this[1]>s&&(this[0]+=t,this[1]=t-this[1],this[2]+=t),Math.abs(this[1])>s-1e-4?(this[0]+=this[2],this[2]=0):wrapPi(this[2]),wrapPi(this[0])}}Object.freeze(Vec4);const Color=Vec4;class Mat4 extends Float32Array{constructor(){super([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}get origin(){return new Vec3(this[12],this[13],this[14])}get scale(){return new Vec3(this[0],this[5],this[9])}get m11(){return this[0]}get m12(){return this[1]}get m13(){return this[2]}get m14(){return this[3]}get m21(){return this[4]}get m22(){return this[5]}get m23(){return this[6]}get m24(){return this[7]}get m31(){return this[8]}get m32(){return this[9]}get m33(){return this[10]}get m34(){return this[11]}get m41(){return this[12]}get m42(){return this[13]}get m43(){return this[14]}get m44(){return this[15]}set m11(t){this[0]=t}set m12(t){this[1]=t}set m13(t){this[2]=t}set m14(t){this[3]=t}set m21(t){this[4]=t}set m22(t){this[5]=t}set m23(t){this[6]=t}set m24(t){this[7]=t}set m31(t){this[8]=t}set m32(t){this[9]=t}set m33(t){this[10]=t}set m34(t){this[11]=t}set m41(t){this[12]=t}set m42(t){this[13]=t}set m43(t){this[14]=t}set m44(t){this[15]=t}set origin(t){(t instanceof Vec3||t instanceof Vec4||Array.isArray(t)&&t.length>=3)&&(this[12]=t[0],this[13]=t[1],this[14]=t[2])}set scale(t){(t instanceof Vec3||t instanceof Vec4||Array.isArray(t)&&t.length>=3)&&(this[0]=t[0],this[5]=t[1],this[9]=t[2])}static isMat4(t){return Object.getPrototypeOf(t).constructor.name===this.name}static determinate(t){let s=t[0],i=t[1],h=t[2],e=t[3],r=t[4],n=t[5],a=t[6],u=t[7],c=t[8],o=t[9],l=t[10],m=t[11],d=t[12],g=t[13],M=t[14],w=t[15];return(s*n-i*r)*(l*w-m*M)-(s*a-h*r)*(o*w-m*g)+(s*u-e*r)*(o*M-l*g)+(i*a-h*n)*(c*w-m*d)-(i*u-e*n)*(c*M-l*d)+(h*u-e*a)*(c*g-o*d)}static inverse(t){let s=t[0],i=t[1],h=t[2],e=t[3],r=t[4],n=t[5],a=t[6],u=t[7],c=t[8],o=t[9],l=t[10],m=t[11],d=t[12],g=t[13],M=t[14],w=t[15],p=l*w,y=M*m,P=a*w,V=M*u,f=a*m,b=l*u,v=h*w,A=M*e,E=h*m,N=l*e,O=h*u,I=a*e,S=c*g,z=d*o,j=r*g,R=d*n,x=r*o,Q=c*n,k=s*g,q=d*i,L=s*o,Z=c*i,_=s*n,F=r*i,C=p*n+V*o+f*g-(y*n+P*o+b*g),B=y*i+v*o+N*g-(p*i+A*o+E*g),D=P*i+A*n+O*g-(V*i+v*n+I*g),G=b*i+E*n+I*o-(f*i+N*n+O*o),X=1/(s*C+r*B+c*D+d*G);return t[0]=X*C,t[1]=X*B,t[2]=X*D,t[3]=X*G,t[4]=X*(y*r+P*c+b*d-(p*r+V*c+f*d)),t[5]=X*(p*s+A*c+E*d-(y*s+v*c+N*d)),t[6]=X*(V*s+v*r+I*d-(P*s+A*r+O*d)),t[7]=X*(f*s+N*r+O*c-(b*s+E*r+I*c)),t[8]=X*(S*u+R*m+x*w-(z*u+j*m+Q*w)),t[9]=X*(z*e+k*m+Z*w-(S*e+q*m+L*w)),t[10]=X*(j*e+q*u+_*w-(R*e+k*u+F*w)),t[11]=X*(Q*e+L*u+F*m-(x*e+Z*u+_*m)),t[12]=X*(j*l+Q*M+z*a-(x*M+S*a+R*l)),t[13]=X*(L*M+S*h+q*l-(k*l+Z*M+z*h)),t[14]=X*(k*a+F*M+R*h-(_*M+j*h+q*a)),t[15]=X*(_*l+x*h+Z*a-(L*a+F*l+Q*h)),t}static lookAt(t,s,i){let h=new Mat4,e=new Vec3,r=new Vec3,n=Vec3.subtract(t,s);return n.toNorm(),e.set(Vec3.crossProduct(i,n)),e.toNorm(),r.set(Vec3.crossProduct(n,e)),r.toNorm(),h[0]=e[0],h[1]=e[1],h[2]=e[2],h[3]=0,h[4]=r[0],h[5]=r[1],h[6]=r[2],h[7]=0,h[8]=n[0],h[9]=n[1],h[10]=n[2],h[11]=0,h[12]=t[0],h[13]=t[1],h[14]=t[2],h[15]=1,h}static multiply(t,s){let i=t[0],h=t[1],e=t[2],r=t[3],n=t[4],a=t[5],u=t[6],c=t[7],o=t[8],l=t[9],m=t[10],d=t[11],g=t[12],M=t[13],w=t[14],p=t[15],y=new Mat4,P=s[0],V=s[1],f=s[2],b=s[3];return y[0]=P*i+V*n+f*o+b*g,y[1]=P*h+V*a+f*l+b*M,y[2]=P*e+V*u+f*m+b*w,y[3]=P*r+V*c+f*d+b*p,P=s[4],V=s[5],f=s[6],b=s[7],y[4]=P*i+V*n+f*o+b*g,y[5]=P*h+V*a+f*l+b*M,y[6]=P*e+V*u+f*m+b*w,y[7]=P*r+V*c+f*d+b*p,P=s[8],V=s[9],f=s[10],b=s[11],y[8]=P*i+V*n+f*o+b*g,y[9]=P*h+V*a+f*l+b*M,y[10]=P*e+V*u+f*m+b*w,y[11]=P*r+V*c+f*d+b*p,P=s[12],V=s[13],f=s[14],b=s[15],y[12]=P*i+V*n+f*o+b*g,y[13]=P*h+V*a+f*l+b*M,y[14]=P*e+V*u+f*m+b*w,y[15]=P*r+V*c+f*d+b*p,y}orthographic(t,s,i,h,e,r){var n=new Mat4;return n[0]=2/(s-t),n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/(h-i),n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2/(e-r),n[11]=0,n[12]=(t+s)/(t-s),n[13]=(i+h)/(i-h),n[14]=(e+r)/(e-r),n[15]=1,n}frustum(t,s,i,h,e,r){var n=new Mat4,a=s-t,u=h-i,c=r-e;return n[0]=2*e/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*e/u,n[6]=0,n[7]=0,n[8]=(t+s)/a,n[9]=(h+i)/u,n[10]=-(r+e)/c,n[11]=-1,n[12]=0,n[13]=0,n[14]=-2*e*r/c,n[15]=0,n}static perspective(t,s,i,h){let e=1/Math.tan(t/2),r=1/(i-h),n=new Mat4;return n[0]=e/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(h+i)*r,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*h*i*r,n[15]=0,n}static rotationX(t){let s=new Mat4,i=Math.cos(t),h=Math.sin(t);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i,s[6]=h,s[7]=0,s[8]=0,s[9]=-h,s[10]=i,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}static rotationY(t){let s=new Mat4,i=Math.cos(t),h=Math.sin(t);return s[0]=i,s[1]=0,s[2]=-h,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=h,s[9]=0,s[10]=i,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}static rotationZ(t){let s=new Mat4,i=Math.cos(t),h=Math.sin(t);return s[0]=i,s[1]=h,s[2]=0,s[3]=0,s[4]=-h,s[5]=i,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}clone(){let t=new Quat;return t.set(this),t}copy(){let t=new Mat4;return t.set(this),t}identity(){return this.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this}static transpose(t,s){if(t===s){var i=s[1],h=s[2],e=s[3],r=s[6],n=s[7],a=s[11];t[1]=s[4],t[2]=s[8],t[3]=s[12],t[4]=i,t[6]=s[9],t[7]=s[13],t[8]=h,t[9]=r,t[11]=s[14],t[12]=e,t[13]=n,t[14]=a}else t[0]=s[0],t[1]=s[4],t[2]=s[8],t[3]=s[12],t[4]=s[1],t[5]=s[5],t[6]=s[9],t[7]=s[13],t[8]=s[2],t[9]=s[6],t[10]=s[10],t[11]=s[14],t[12]=s[3],t[13]=s[7],t[14]=s[11],t[15]=s[15]}static invert(t,s){let i=s[0],h=s[1],e=s[2],r=s[3],n=s[4],a=s[5],u=s[6],c=s[7],o=s[8],l=s[9],m=s[10],d=s[11],g=s[12],M=s[13],w=s[14],p=s[15],y=i*a-h*n,P=i*u-e*n,V=i*c-r*n,f=h*u-e*a,b=h*c-r*a,v=e*c-r*u,A=o*M-l*g,E=o*w-m*g,N=o*p-d*g,O=l*w-m*M,I=l*p-d*M,S=m*p-d*w,z=y*S-P*I+V*O+f*N-b*E+v*A;z=1/z,t[0]=(a*S-u*I+c*O)*z,t[1]=(e*I-h*S-r*O)*z,t[2]=(M*v-w*b+p*f)*z,t[3]=(m*b-l*v-d*f)*z,t[4]=(u*N-n*S-c*E)*z,t[5]=(i*S-e*N+r*E)*z,t[6]=(w*V-g*v-p*P)*z,t[7]=(o*v-m*V+d*P)*z,t[8]=(n*I-a*N+c*A)*z,t[9]=(h*N-i*I-r*A)*z,t[10]=(g*b-M*V+p*y)*z,t[11]=(l*V-o*b-d*y)*z,t[12]=(a*E-n*O-u*A)*z,t[13]=(i*O-h*E+e*A)*z,t[14]=(M*P-g*f-w*y)*z,t[15]=(o*f-l*P+m*y)*z}mul(t){let s=this[0],i=this[1],h=this[2],e=this[3],r=this[4],n=this[5],a=this[6],u=this[7],c=this[8],o=this[9],l=this[10],m=this[11],d=this[12],g=this[13],M=this[14],w=this[15],p=t[0],y=t[1],P=t[2],V=t[3];return this[0]=p*s+y*r+P*c+V*d,this[1]=p*i+y*n+P*o+V*g,this[2]=p*h+y*a+P*l+V*M,this[3]=p*e+y*u+P*m+V*w,p=t[4],y=t[5],P=t[6],V=t[7],this[4]=p*s+y*r+P*c+V*d,this[5]=p*i+y*n+P*o+V*g,this[6]=p*h+y*a+P*l+V*M,this[7]=p*e+y*u+P*m+V*w,p=t[8],y=t[9],P=t[10],V=t[11],this[8]=p*s+y*r+P*c+V*d,this[9]=p*i+y*n+P*o+V*g,this[10]=p*h+y*a+P*l+V*M,this[11]=p*e+y*u+P*m+V*w,p=t[12],y=t[13],P=t[14],V=t[15],this[12]=p*s+y*r+P*c+V*d,this[13]=p*i+y*n+P*o+V*g,this[14]=p*h+y*a+P*l+V*M,this[15]=p*e+y*u+P*m+V*w,this}rotate(t,s){let i,h,e,r,n,a,u,c,o,l,m,d,g,M,w,p,y,P,V,f,b,v,A,E,N=s[0],O=s[1],I=s[2],S=Math.hypot(N,O,I);return S<EPSILON?null:(N*=S=1/S,O*=S,I*=S,i=Math.sin(t),e=1-(h=Math.cos(t)),r=this[0],n=this[1],a=this[2],u=this[3],c=this[4],o=this[5],l=this[6],m=this[7],d=this[8],g=this[9],M=this[10],w=this[11],p=N*N*e+h,y=O*N*e+I*i,P=I*N*e-O*i,V=N*O*e-I*i,f=O*O*e+h,b=I*O*e+N*i,v=N*I*e+O*i,A=O*I*e-N*i,E=I*I*e+h,this[0]=r*p+c*y+d*P,this[1]=n*p+o*y+g*P,this[2]=a*p+l*y+M*P,this[3]=u*p+m*y+w*P,this[4]=r*V+c*f+d*b,this[5]=n*V+o*f+g*b,this[6]=a*V+l*f+M*b,this[7]=u*V+m*f+w*b,this[8]=r*v+c*A+d*E,this[9]=n*v+o*A+g*E,this[10]=a*v+l*A+M*E,this[11]=u*v+m*A+w*E,this)}rotateX(t){let s=Math.cos(t),i=Math.sin(t);return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=s,this[6]=i,this[7]=0,this[8]=0,this[9]=-i,this[10]=s,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this}rotateY(t){let s=Math.cos(t),i=Math.sin(t);return this[0]=s,this[1]=0,this[2]=-i,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=i,this[9]=0,this[10]=s,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this}rotateZ(t){let s=Math.cos(t),i=Math.sin(t);return this[0]=s,this[1]=i,this[2]=0,this[3]=0,this[4]=-i,this[5]=s,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this}}Object.freeze(Mat4);class Quat extends Vec4{constructor(t=0,s=0,i=0,h=1){super([0,0,0,0])}static isQuat(t){return Object.getPrototypeOf(t).constructor.name===this.name}static slerp(t,s,i){let h,e,r,n,a,u=t[0],c=t[1],o=t[2],l=t[3],m=s[0],d=s[1],g=s[2],M=s[3];return(e=u*m+c*d+o*g+l*M)<0&&(e=-e,m=-m,d=-d,g=-g,M=-M),1-e>EPSILON?(h=Math.acos(e),r=Math.sin(h),n=Math.sin((1-i)*h)/r,a=Math.sin(i*h)/r):(n=1-i,a=i),this[0]=n*u+a*m,this[1]=n*c+a*d,this[2]=n*o+a*g,this[3]=n*l+a*M,this}static toEuler(t){let s=new Vec3,i=2*(t[3]*t[0]+t[1]*t[2]),h=1-2*(t[0]*t[0]+t[1]*t[1]);s.roll=Math.atan2(i,h);let e=2*(t[3]*t[1]-t[2]*t[0]);if(Math.abs(e)>=1)s.pitch=copysign(PI/2,e);else{s.pitch=Math.asin(e);let i=2*(t[3]*t[2]+t[0]*t[1]),h=1-2*(t[1]*t[1]+t[2]*t[2]);s.yaw=Math.atan2(i,h)}return s}mul(t){let s=this[0],i=this[1],h=this[2],e=this[3],r=t[0],n=t[1],a=t[2],u=t[3];return this[0]=s*u+e*r+i*a-h*n,this[1]=i*u+e*n+h*r-s*a,this[2]=h*u+e*a+s*n-i*r,this[3]=e*u-s*r-i*n-h*a,this}static multiply(t,s){let i=t[0],h=t[1],e=t[2],r=t[3],n=s[0],a=s[1],u=s[2],c=s[3],o=new Quat;return o[0]=i*c+r*n+h*u-e*a,o[1]=h*c+r*a+e*n-i*u,o[2]=e*c+r*u+i*a-h*n,o[3]=r*c-i*n-h*a-e*u,o}}Object.freeze(Quat);